---
paths: ["**/*"]
alwaysApply: true
---

# Security Rules - 安全规则

## 高风险操作警告

以下操作需要特别谨慎，可能需要人工审批：

### 🔴 禁止自动执行
- 推送到受保护分支（main, master, release/*）
- 删除生产数据或配置
- 修改认证/授权逻辑
- 修改加密/安全相关代码
- 执行涉及支付的代码变更

### 🟡 需要审批
- 大范围重构（>20% 代码变更）
- 升级主版本依赖
- 修改数据库 schema
- 添加新的外部服务调用
- 修改 CI/CD 配置

### 🟢 允许自动执行
- 读取文件
- 代码搜索
- 运行测试
- 代码格式化
- 添加注释和文档

## 代码安全规则

### 输入验证
- 所有外部输入必须验证
- 使用白名单验证，而非黑名单
- 验证长度、格式、类型
- 对文件路径进行规范化

### 注入防护
- SQL 查询使用参数化
- 避免动态构建命令
- HTML 输出必须转义
- 使用安全的模板引擎

### 认证授权
- 敏感操作需要认证
- 遵循最小权限原则
- 检查资源所有权
- 记录安全相关操作

### 数据保护
- 密码使用强哈希存储（bcrypt/argon2）
- 敏感数据传输使用 TLS
- 日志不包含敏感信息
- 正确处理 PII 数据

### 依赖安全
- 定期检查依赖漏洞
- 使用 lock 文件固定版本
- 从官方源安装依赖
- 审查新增依赖

## 审计日志

以下操作必须记录到审计日志：
- 文件创建/修改/删除
- 命令执行
- 关键决策
- 错误和异常

日志格式：
```
[{timestamp}] [{level}] [{action}] {details}
```

## 敏感信息处理

### 绝不能出现在代码中
- API 密钥
- 数据库密码
- 私钥
- 个人身份信息

### 安全的处理方式
- 使用环境变量
- 使用密钥管理服务
- 使用配置文件（不提交到版本控制）
- 使用 .gitignore 排除敏感文件

